# Copyright (C) 2021 Torbjorn Sjostrand.
# PYTHIA is licenced under the GNU GPL v2 or later, see COPYING for details.
# Please respect the MCnet Guidelines, see GUIDELINES for details.
# Author: Philip Ilten and Stefan Prestel, September 2020.
# Dockerfile for building the MadGraph 5 plugin generator for Pythia 8.3.
FROM fedora:24
MAINTAINER Pythia 8 Collaboration "pythia8@projects.hepforge.org"

# Set environment variables.
ENV DNF_CACHE /var/cache/dnf
ENV DNF_INSTALL tar python
ENV DNF_REMOVE tar
ENV PYTHONPATH /models

# The following is a single RUN command to reduce the image size.

# Install dependencies.
RUN dnf -y install $DNF_INSTALL; \
\
# Download and unpack MadGraph.; \
curl -o mg5mes.tgz\
 https://cernbox.cern.ch/index.php/s/ka9fzH9MeYr7NU7/download; \
tar -xzf mg5mes.tgz; \
rm mg5mes.tgz; \
\
# Create a fake compiler.; \
echo "echo 'DUMMY COMPILER'" > /bin/g++; \
chmod a+x /bin/g++; \
\
# Clean up.; \
dnf -y remove $DNF_REMOVE; \
dnf -y autoremove; \
rm -rf $DNF_CACHE/*

# Create the entry point.
ENTRYPOINT ["/mg5mes/bin/mg5_aMC"]